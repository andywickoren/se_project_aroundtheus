!function(){"use strict";class e{constructor(e,t,s,i,n,r){this._name=e.name,this._link=e.link,this._id=e._id,this._isLiked=e.isLiked||!1,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=i,this._handleAddLike=n,this._handleRemoveLike=r}getID(){return this._id}isLiked(){return this._isLiked}setLiked(e){this._isLiked=e,this._likeButton.classList.toggle("card__like-button_active",e)}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this.isLiked()?this._handleRemoveLike(this):this._handleAddLike(this)})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick()})),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardTitle.textContent=this._name,this._cardImage.addEventListener("click",(()=>{this._handleImageClick(this._name,this._link)}))}handleDeleteCard(){this._cardElement.remove(),this._cardElement=null}handleLikeIcon(){this._likeButton.classList.toggle("card__like-button_active")}getView(){return this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0),this._cardTitle=this._cardElement.querySelector(".card__title"),this._cardImage=this._cardElement.querySelector(".card__image"),this._likeButton=this._cardElement.querySelector(".card__like-button"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this.setLiked(this._isLiked),this._setEventListeners(),this._cardElement}}class t{constructor(e,t){this._settings=e,this._formElement=t,this._inputElements=Array.from(t.querySelectorAll(e.inputSelector)),this._submitButton=t.querySelector(e.submitButtonSelector),this._setEventListeners()}_showInputError(e,t){const s=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._settings.inputErrorClass),s.textContent=t,s.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._settings.inputErrorClass),t.textContent="",t.classList.remove(this._settings.errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_toggleButtonState(){const e=this._inputElements.some((e=>!e.validity.valid));this._submitButton.disabled=e,this._submitButton.classList.toggle(this._settings.inactiveButtonClass,e)}_setEventListeners(){this._inputElements.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._toggleButtonState()}resetValidation(){this._inputElements.forEach((e=>this._hideInputError(e))),this._submitButton.disabled=!0,this._submitButton.classList.add(this._settings.inactiveButtonClass)}}class s{constructor(e){this._modalElement=document.querySelector(e),this._closeButton=this._modalElement.querySelector(".modal__close"),this._handleModalClose=this._handleModalClose.bind(this)}open(){this._modalElement.classList.add("modal__opened"),document.addEventListener("keydown",this._handleEscape)}close(){this._modalElement.classList.remove("modal__opened"),document.removeEventListener("keydown",this._handleEscape)}_handleEscape=e=>{"Escape"===e.key&&this.close()};_handleModalClose(e){(e.target.classList.contains("modal")||e.target.classList.contains("modal__close"))&&this.close()}getElement(){return this._modalElement}setEventListeners(){this._modalElement.addEventListener("mousedown",this._handleModalClose)}}class i extends s{constructor(e,t){super(e),this._handleFormSubmit=t.bind(this),this._modalForm=this._modalElement.querySelector(".modal__form")}_getInputValues(){const e=this._modalForm.querySelectorAll(".modal__input"),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setEventListeners(){super.setEventListeners(),this._modalForm.addEventListener("submit",(e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t)}))}reset(){this._modalForm.reset()}}const n={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},r=document.forms["edit-modal-form"],o=document.forms["add-card-form"],a=document.querySelector("#profile-edit-modal"),l=(a.querySelector("#edit-modal-close-button"),document.querySelector("#profile-edit-button")),d=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),h=document.querySelector(".profile__add-button"),_=a.querySelector(".modal__form"),m=_.querySelector(".modal__input_type_name"),u=_.querySelector(".modal__input_type_description"),p=new class{constructor(e){let{baseUrl:t}=e;this._baseUrl=t,this._authToken="20e48b0c-8946-48f3-99d9-01b588193102"}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._authToken}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._authToken}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}renderCards(){return Promise.all()}addCard(e){let{name:t,link:s}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:s})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:this._authToken,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:{authorization:this._authToken,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:{authorization:this._authToken,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}changeProfilePicture(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1"}),E=new t(n,r);E.enableValidation();const k=new t(n,o),f=new i("#add-card-modal",(function(e){const t=e.title,s=e.url;p.addCard({name:t,link:s}).then((e=>{const t=q(e);L.prependItem(t),f.close(),k.resetValidation(),f.reset()})).catch((e=>{console.error(e)}))})),v=new class extends s{setSubmitAction(e){this._submitCallback=e}setEventListeners(){super.setEventListeners(),confirmDeleteElement.addEventListener("click",(()=>{this._submitCallback}))}open(){this.setSubmitAction(),super.open()}}("#delete-card-modal"),L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}}({renderer:e=>{const t=q(e);L.addItem(t)}},".cards__list");p.getInitialCards().then((e=>{L.renderItems(e)})).catch((e=>{console.error(e)}));const g=new class extends s{constructor(e){super(e),this._name=this._modalElement.querySelector(".modal__image-label"),this._image=this._modalElement.querySelector(".modal__preview-image")}open(e,t){this._image.src=t,this._name.textContent=e,this._image.alt=`Photo of ${this._name}`,super.open()}}("#preview-image-modal");k.enableValidation();const b=new class{constructor(e){let{profileName:t,profileDescription:s}=e;this._profileName=t,this._profileDescription=s}getUserInfo(){return{name:this._profileName.textContent,description:this._profileDescription.textContent}}setUserInfo(e){let{title:t,description:s}=e;this._profileName.textContent=t,this._profileDescription.textContent=s}}({profileName:d,profileDescription:c});p.getUserInfo().then((e=>{b.setUserInfo({title:e.name,description:e.about})})).catch((e=>{console.error(e)}));const y=v.getElement();function S(){const e=this.getID();v.open(),console.log(y);const t=y.querySelector("#modal__confirm-card-delete");console.log(t),t.addEventListener("click",(()=>{p.removeCard(e).then((()=>{this.handleDeleteCard()}))}))}function C(e){const t=e.getID();p.addLike(t).then((t=>{e.setLiked(!0)})).catch((e=>{console.error(e)}))}function I(e){const t=e.getID();p.removeLike(t).then((t=>{e.setLiked(!1)})).catch((e=>{console.error(e)}))}function q(t){return new e(t,"#card-template",B,S,C,I).getView()}function B(e,t){g.open(e,t)}y.querySelector("#modal__confirm-card-delete").addEventListener("click",(()=>{p.removeCard(id).then((()=>{(void 0).handleDeleteCard()}))})),v.setSubmitAction(S),h.addEventListener("click",(()=>{f.open()}));const T=new i("#profile-edit-modal",(function(e){T.close(),T.reset()}));g.setEventListeners(),T.setEventListeners(),f.setEventListeners(),v.setEventListeners(),l.addEventListener("click",(()=>{const e=b.getUserInfo();m.value=e.name,u.value=e.description,E.resetValidation(),T.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGlCQUFpQixTQUFTLEtBQ3pDOEgsRUFBYXJFLE1BQU0sSUFHckIsTUFBTWdILEVBQW1CLElBQUl0RyxFQUMzQix1QkE5QkYsU0FBaUNVLEdBYS9CNEYsRUFBaUI5RyxRQUNqQjhHLEVBQWlCM0YsT0FDbkIsSUFtQkErRSxFQUFXM0Ysb0JBQ1h1RyxFQUFpQnZHLG9CQUNqQjRELEVBQWE1RCxvQkFDYndFLEVBQWdCeEUsb0JBRWhCbUIsRUFBa0JyRixpQkFBaUIsU0FBUyxLQUMxQyxNQUFNMEssRUFBa0JYLEVBQVNuRCxjQUNqQ2xCLEVBQWlCZCxNQUFROEYsRUFBZ0IzTCxLQUN6QzRHLEVBQXdCZixNQUFROEYsRUFBZ0JSLFlBQ2hEdEMsRUFBcUIxRSxrQkFDckJ1SCxFQUFpQmhILE1BQU0sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Nb2RhbFdpdGhGb3JtU3VibWl0LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvTW9kYWxXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGRhdGEsXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgaGFuZGxlRGVsZXRlQ2xpY2ssXG4gICAgaGFuZGxlQWRkTGlrZSxcbiAgICBoYW5kbGVSZW1vdmVMaWtlXG4gICkge1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkOyAvL3lvdSBhZGRlZCB0aGlzIHVuZGVyc2NvcmUgYmFzZWQgb24gdGhlIGJyaWVmXG4gICAgdGhpcy5faXNMaWtlZCA9IGRhdGEuaXNMaWtlZCB8fCBmYWxzZTtcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sgPSBoYW5kbGVEZWxldGVDbGljaztcbiAgICAvLyB0aGlzLl9kZWxldGVDYXJkTW9kYWwgPSBkZWxldGVDYXJkTW9kYWw7XG4gICAgdGhpcy5faGFuZGxlQWRkTGlrZSA9IGhhbmRsZUFkZExpa2U7XG4gICAgdGhpcy5faGFuZGxlUmVtb3ZlTGlrZSA9IGhhbmRsZVJlbW92ZUxpa2U7XG4gIH1cblxuICBnZXRJRCgpIHtcbiAgICByZXR1cm4gdGhpcy5faWQ7XG4gIH1cblxuICBpc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9pc0xpa2VkO1xuICB9XG5cbiAgc2V0TGlrZWQoaXNMaWtlZCkge1xuICAgIHRoaXMuX2lzTGlrZWQgPSBpc0xpa2VkO1xuICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiLCBpc0xpa2VkKTtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5pc0xpa2VkKCkpIHtcbiAgICAgICAgdGhpcy5faGFuZGxlUmVtb3ZlTGlrZSh0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUFkZExpa2UodGhpcyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gfSk7XG5cbiAgICB0aGlzLl9kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkVGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKTtcbiAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZURlbGV0ZUNhcmQoKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgaGFuZGxlTGlrZUljb24oKSB7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICB9XG5cbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgdGhpcy5fY2FyZFRpdGxlID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5jYXJkX19kZWxldGUtYnV0dG9uXCJcbiAgICApO1xuXG4gICAgdGhpcy5zZXRMaWtlZCh0aGlzLl9pc0xpa2VkKTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50O1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMgPSBBcnJheS5mcm9tKFxuICAgICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgfVxuXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IHRoaXMuX2lucHV0RWxlbWVudHMuc29tZShcbiAgICAgIChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWRcbiAgICApO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGhhc0ludmFsaWRJbnB1dDtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcbiAgICAgIHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MsXG4gICAgICBoYXNJbnZhbGlkSW5wdXRcbiAgICApO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT5cbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudClcbiAgICApO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsIHtcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3Rvcikge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobW9kYWxTZWxlY3Rvcik7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XG4gICAgdGhpcy5faGFuZGxlTW9kYWxDbG9zZSA9IHRoaXMuX2hhbmRsZU1vZGFsQ2xvc2UuYmluZCh0aGlzKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9fb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY2FwZSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX19vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjYXBlKTtcbiAgfVxuXG4gIF9oYW5kbGVFc2NhcGUgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgX2hhbmRsZU1vZGFsQ2xvc2UoZXZ0KSB7XG4gICAgaWYgKFxuICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSB8fFxuICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fY2xvc2VcIilcbiAgICApIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBnZXRFbGVtZW50KCkge1xuICAgIHJldHVybiB0aGlzLl9tb2RhbEVsZW1lbnQ7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVNb2RhbENsb3NlKTtcbiAgfVxufVxuIiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEZvcm0gZXh0ZW5kcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcbiAgICBzdXBlcihtb2RhbFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX21vZGFsRm9ybSA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGlucHV0cyA9IHRoaXMuX21vZGFsRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKTtcbiAgICBjb25zdCBpbnB1dE9iaiA9IHt9O1xuXG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dE9ialtpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlucHV0T2JqO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9tb2RhbEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHRoaXMuX2dldElucHV0VmFsdWVzKCk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KGlucHV0VmFsdWVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMuX21vZGFsRm9ybS5yZXNldCgpO1xuICB9XG59XG4iLCJleHBvcnQgY29uc3QgdmFsaWRhdGlvblNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3NhdmUtYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5leHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QveW9zZW1pdGUuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xha2UtbG91aXNlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYXRlbWFyLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvdmFub2lzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFnby5qcGdcIixcbiAgfSxcbl07XG5cbmV4cG9ydCBjb25zdCBjYXJkTGlzdFNlbGVjdG9yID0gXCIuY2FyZHNfX2xpc3RcIjtcbmV4cG9ydCBjb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1tb2RhbC1mb3JtXCJdO1xuZXhwb3J0IGNvbnN0IGFkZENhcmRGb3JtRWxlbWVudCA9IGRvY3VtZW50LmZvcm1zW1wiYWRkLWNhcmQtZm9ybVwiXTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtbW9kYWxcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZU1vZGFsQ2xvc2VCdXR0b24gPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI2VkaXQtbW9kYWwtY2xvc2UtYnV0dG9uXCJcbik7XG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1idXR0b25cIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIlxuKTtcbmV4cG9ydCBjb25zdCBhZGROZXdDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtRWxlbWVudCA9XG4gIHByb2ZpbGVFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZUlucHV0ID0gcHJvZmlsZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19pbnB1dF90eXBlX25hbWVcIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IHByb2ZpbGVGb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9faW5wdXRfdHlwZV9kZXNjcmlwdGlvblwiXG4pO1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbC5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aEZvcm1TdWJtaXQgZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybVN1Ym1pdC5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL01vZGFsV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCB7XG4gIGluaXRpYWxDYXJkcyxcbiAgdmFsaWRhdGlvblNldHRpbmdzLFxuICBjYXJkTGlzdFNlbGVjdG9yLFxuICBwcm9maWxlRm9ybSxcbiAgYWRkQ2FyZEZvcm1FbGVtZW50LFxuICBwcm9maWxlRWRpdEJ1dHRvbixcbiAgcHJvZmlsZU5hbWUsXG4gIHByb2ZpbGVEZXNjcmlwdGlvbixcbiAgYWRkTmV3Q2FyZEJ1dHRvbixcbiAgcHJvZmlsZU5hbWVJbnB1dCxcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQsXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIC8vIGhlYWRlcnM6IHtcbiAgLy8gICBhdXRob3JpemF0aW9uOiBcIjIwZTQ4YjBjLTg5NDYtNDhmMy05OWQ5LTAxYjU4ODE5MzEwMlwiLFxuICAvLyAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAvLyB9LFxufSk7XG5cbi8vIEdFVCBodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MS91c2Vycy9tZVxuXG4vLyBmZXRjaChcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxL2NhcmRzXCIsIHtcbi8vICAgaGVhZGVyczoge1xuLy8gICAgIGF1dGhvcml6YXRpb246IFwiMGFmY2E5OWQtODE1My00NDdhLWE1YTItZTg2YWY5N2JlZThmXCIsXG4vLyAgIH0sXG4vLyB9KVxuLy8gICAudGhlbigocmVzKSA9PiByZXMuanNvbigpKVxuLy8gICAudGhlbigocmVzdWx0KSA9PiB7XG4vLyAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbi8vICAgfSk7XG5cbi8vIGFwaVxuLy8gICAuZ2V0SW5pdGlhbENhcmRzKClcbi8vICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuLy8gICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4vLyAgICAgLy8gcHJvY2VzcyB0aGUgcmVzdWx0XG4vLyAgIH0pXG4vLyAgIC5jYXRjaCgoZXJyKSA9PiB7XG4vLyAgICAgY29uc29sZS5lcnJvcihlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4vLyAgIH0pO1xuXG4vLyBhcGlcbi8vICAgLmdldFVzZXJJbmZvKClcbi8vICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuLy8gICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4vLyAgIH0pXG4vLyAgIC5jYXRjaCgoZXJyKSA9PiB7XG4vLyAgICAgY29uc29sZS5lcnJvcihlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4vLyAgIH0pO1xuXG5jb25zdCBwcm9maWxlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHZhbGlkYXRpb25TZXR0aW5ncywgcHJvZmlsZUZvcm0pO1xuXG5wcm9maWxlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGFkZENhcmRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gIHZhbGlkYXRpb25TZXR0aW5ncyxcbiAgYWRkQ2FyZEZvcm1FbGVtZW50XG4pO1xuXG4vLyAhIHx8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18fFxuLy8gISB8fCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVsZW1lbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHxcbi8vICEgfHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXx8XG5cbi8qIFRoaXMgaXMgaW1wb3J0YW50IGJlY2F1c2UgdGhpcyBpcyB3aGVyZSBoYW5kbGVBZGRDYXJkRm9ybVN1Ym1pdCBpcyBwYXNzZWQgaW50byBhIGRpZmZlcmVudCBmaWxlXG5BbmQgdGhhdCBmaWxlIGlzIGFjdHVhbGx5IHdoZXJlIHRoZSBpbnB1dFZhbHVlcyBwYXJhbWV0ZXIgYmVjb21lcyBhIGRlZmluaXRpdmUgYXJndW1lbnQuICBJbmRleC5qcyB5b3Vcbm9ubHkgaGF2ZSBoYW5kbGVBZGRDYXJkRm9ybVN1Ym1pdCBkZWNsYXJlZCB3aXRoIGEgcGFyYW0gYW5kIHBhc3NlZCBhcyBhIGNhbGxiYWNrLiAgWW91IGRvbid0IGtub3cgdGhlIFxudmFsdWUgb2YgdGhlIGFyZ3VtZW50IHVudGlsIHlvdSBnbyB0byB0aGUgbW9kdWxlIHdoZXJlIHRoZSBjYWxsYmFjayB3YXMgcGFzc2VkLiAgWW91IFwiZm9sbG93IHRoZSBmdW5jdGlvblxuaW50byB0aGUgY2xhc3NcIiwgdGhlbiB0aGUgc3ludGF4IGhpZ2hsaWdodGluZ1xuaXMgaGVscGZ1bCwgZXZlbnR1YWxseSB5b3Ugc2VlIHRoaXMuX2hhbmRsZUFkZENhcmRGb3JtU3VibWl0KGlucHV0VmFsdWVzKTsgd2hpY2ggaXMgYWN0dWFsbHkgcmV0dXJuZWQgZnJvbVxudGhlIHByaXZhdGUgbWV0aG9kXG5fZ2V0SW5wdXRWYWx1ZXMoKS4gIFxuU28gdGhlIGFuc3dlciBmb3Igd2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIGFyZ3VtZW50IGZvciBoYW5kbGVBZGRDYXJkRm9ybSBzdWJtaXRcbkl0IGlzIHRoZSBvYmplY3QgcmV0dXJuZWQgYnkgZ2V0SW5wdXRWYWx1ZXMgcHJ2aWF0ZSBtZXRob2QgZHVyaW5nIHRoZSBzdWJtaXQgZXZlbnQsIHdoZW4gdGhlIGNhcmQgaXMgc3VibWl0dGVkLlxuZ2V0SW5wdXRWYWx1ZXMgc2VsZWN0cyBhbGwgdGhlIGlucHV0cywgbWFrZXMgYW4gb2JqZWN0LCBhbmQgc2V0cyB0aGUgbmFtZSBwcm9wZXJ0eSBlcXVhbFxudG8gdGhlIHZhbHVlIG9mIHdoYXRldmVyIHdhcyB0eXBlZCBpbiwgc28geW91IGVuZCB1cCB3aXRoIGp1c3QgYW4gb2JqZWN0IHdpdGggbmFtZSA6IHZhbHVlLiAgICovXG5cbmNvbnN0IGFkZENhcmRNb2RhbCA9IG5ldyBNb2RhbFdpdGhGb3JtKFxuICBcIiNhZGQtY2FyZC1tb2RhbFwiLFxuICBoYW5kbGVBZGRDYXJkRm9ybVN1Ym1pdFxuKTtcbmNvbnN0IGRlbGV0ZUNhcmRNb2RhbCA9IG5ldyBNb2RhbFdpdGhGb3JtU3VibWl0KFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xuXG4vKiBBbHJpZ2h0IGJybyBzbyBub3cgd2UgY3JlYXRlIGEgbmV3IFNlY3Rpb24gd2hpY2ggaGFzIGJhc2ljYWxseSBub3RoaW5nIGRlZmluZWQgZXhjZXB0IHRoZSBjYWxsYmFja1xuZnVuY3Rpb24gYW5kIHRoZSBzZWxlY3Rvci4gIFdlIHRvb2sgaXRlbXMgb3V0IG9mIHRoZSBjb25zdHJ1Y3RvciBhbmQgcGxhY2VkIGl0IGFzIGEgcGFyYW0gb2YgdGhlIFxucmVuZGVySXRlbXMgbWV0aG9kIHNvIHRoYXQgY2FyZHNMaXN0IGNhbiBiZSBpbnN0YW50aWF0ZWQgd2l0aG91dCBuZWVkaW5nIHRoaXMgZGF0YSBmcm9tIHRoZSBBUEksIHRoZXJlZm9yZVxubmV3IFNlY3Rpb24gY2FuIGJlIGluc3RhbnRpYXRlZCB3aXRob3V0IGJlaW5nIGxpbWl0ZWQgdG8gYSBzY29wZSB3aXRoaW4gXG5hcGkuZ2V0SW5pdGlhbENhcmRzKCkudGhlbihjYXJkcykgPT4ge30gKi9cblxuY29uc3QgY2FyZHNMaXN0ID0gbmV3IFNlY3Rpb24oXG4gIHtcbiAgICByZW5kZXJlcjogKGNhcmQpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkKTtcbiAgICAgIGNhcmRzTGlzdC5hZGRJdGVtKGNhcmRFbGVtZW50KTtcbiAgICB9LFxuICB9LFxuICBjYXJkTGlzdFNlbGVjdG9yXG4pO1xuXG4vKiBUaGlzIGFwaSBtbWV0aG9kIGZldGNoZXMgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGF0IGEgc3BlY2lmaWVkIFVSTCwgdGhlbiB3ZSBjYWxsIHJlbmRlckl0ZW1zIHdpdGggXG50aGlzIGRhdGEuIFNpbXBsZSAqL1xuXG5hcGlcbiAgLmdldEluaXRpYWxDYXJkcygpXG4gIC50aGVuKChjYXJkcykgPT4ge1xuICAgIGNhcmRzTGlzdC5yZW5kZXJJdGVtcyhjYXJkcyk7XG4gIH0pIC8vc2hvdWxkIHdlIGJlIGNhdGNoaW5nIGl0IGhlcmUgb3IgaW4gdGhlIGNsYXNzPyAgSGVyZVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KTtcblxuY29uc3QgaW1hZ2VNb2RhbCA9IG5ldyBNb2RhbFdpdGhJbWFnZShcIiNwcmV2aWV3LWltYWdlLW1vZGFsXCIpO1xuYWRkQ2FyZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vL0Zvcm0gZGF0YVxuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIHByb2ZpbGVOYW1lOiBwcm9maWxlTmFtZSxcbiAgcHJvZmlsZURlc2NyaXB0aW9uOiBwcm9maWxlRGVzY3JpcHRpb24sXG59KTtcblxuYXBpXG4gIC5nZXRVc2VySW5mbygpXG4gIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcbiAgICAgIHRpdGxlOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHVzZXJEYXRhLmFib3V0LFxuICAgIH0pO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgfSk7XG4vLyAvLyAhIHx8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18fFxuLy8gLy8gISB8fCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHxcbi8vIC8vICEgfHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXx8XG5cbi8vIG5vdyB0aGlzIGlzIGJlaW5nIHBhc3NlZCB0byB0aGUgc2V0U3VibWl0QWN0aW9uIG1ldGhvZCBvZiB0aGUgc2V0U3VibWl0QWN0aW9uXG4vLyBNb2RhbFdpdGhGb3JtU3VibWl0XG5jb25zdCBtb2RhbEVsZW1lbnQgPSBkZWxldGVDYXJkTW9kYWwuZ2V0RWxlbWVudCgpO1xuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDbGljaygpIHtcbiAgY29uc3QgaWQgPSB0aGlzLmdldElEKCk7XG4gIGRlbGV0ZUNhcmRNb2RhbC5vcGVuKCk7XG4gIGNvbnNvbGUubG9nKG1vZGFsRWxlbWVudCk7XG4gIGNvbnN0IGNvbmZpcm1EZWxldGVFbGVtZW50ID0gbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgXCIjbW9kYWxfX2NvbmZpcm0tY2FyZC1kZWxldGVcIlxuICApO1xuICBjb25zb2xlLmxvZyhjb25maXJtRGVsZXRlRWxlbWVudCk7XG4gIGNvbmZpcm1EZWxldGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgYXBpLnJlbW92ZUNhcmQoaWQpLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVEZWxldGVDYXJkKCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5jb25zdCBjb25maXJtRGVsZXRlRWxlbWVudCA9IG1vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNtb2RhbF9fY29uZmlybS1jYXJkLWRlbGV0ZVwiXG4pO1xuXG5jb25maXJtRGVsZXRlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhcGkucmVtb3ZlQ2FyZChpZCkudGhlbigoKSA9PiB7XG4gICAgdGhpcy5oYW5kbGVEZWxldGVDYXJkKCk7XG4gIH0pO1xufSk7XG5cbmRlbGV0ZUNhcmRNb2RhbC5zZXRTdWJtaXRBY3Rpb24oaGFuZGxlRGVsZXRlQ2xpY2spO1xuXG4vLyBmdW5jdGlvbiBoYW5kbGVBZGRMaWtlKCkge1xuLy8gICBjb25zdCBpZCA9IHRoaXMuZ2V0SUQoKTtcbi8vICAgYXBpLmFkZExpa2UoaWQpLnRoZW4oKCkgPT4ge1xuLy8gICAgIHRoaXMuaGFuZGxlTGlrZUljb24oKTtcbi8vICAgfSk7XG4vLyB9XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZExpa2UoY2FyZCkge1xuICBjb25zdCBpZCA9IGNhcmQuZ2V0SUQoKTtcbiAgYXBpXG4gICAgLmFkZExpa2UoaWQpXG4gICAgLnRoZW4oKHVwZGF0ZWRDYXJkRGF0YSkgPT4ge1xuICAgICAgY2FyZC5zZXRMaWtlZCh0cnVlKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSk7XG59XG5cbi8vIGZ1bmN0aW9uIGhhbmRsZVJlbW92ZUxpa2UoKSB7XG4vLyAgIGNvbnN0IGlkID0gdGhpcy5nZXRJRCgpO1xuLy8gICBhcGkucmVtb3ZlTGlrZShpZCkudGhlbigoKSA9PiB7XG4vLyAgICAgdGhpcy5oYW5kbGVMaWtlSWNvbigpO1xuLy8gICB9KTtcbi8vIH1cblxuZnVuY3Rpb24gaGFuZGxlUmVtb3ZlTGlrZShjYXJkKSB7XG4gIGNvbnN0IGlkID0gY2FyZC5nZXRJRCgpO1xuICBhcGlcbiAgICAucmVtb3ZlTGlrZShpZClcbiAgICAudGhlbigodXBkYXRlZENhcmREYXRhKSA9PiB7XG4gICAgICBjYXJkLnNldExpa2VkKGZhbHNlKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoZGF0YSkge1xuICBjb25zdCBuZXdDYXJkID0gbmV3IENhcmQoXG4gICAgZGF0YSxcbiAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDbGljayxcbiAgICBoYW5kbGVBZGRMaWtlLFxuICAgIGhhbmRsZVJlbW92ZUxpa2VcbiAgKTtcbiAgY29uc3QgbmV3Q2FyZEVsZW1lbnQgPSBuZXdDYXJkLmdldFZpZXcoKTtcbiAgcmV0dXJuIG5ld0NhcmRFbGVtZW50O1xufVxuXG4vLyAvLyAhIHx8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18fFxuLy8gLy8gISB8fCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV2ZW50IEhhbmRsZXJzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHxcbi8vIC8vICEgfHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXx8XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIC8vIGNvbnNvbGUubG9nKHRoaXMuX21vZGFsRm9ybSk7XG4gIGNvbnN0IG5hbWUgPSBpbnB1dFZhbHVlcy50aXRsZTtcbiAgY29uc3QgbGluayA9IGlucHV0VmFsdWVzLnVybDtcbiAgYXBpXG4gICAgLmFkZENhcmQoeyBuYW1lLCBsaW5rIH0pXG4gICAgLnRoZW4oKG5ld0NhcmREYXRhKSA9PiB7XG4gICAgICBjb25zdCBuZXdDYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQobmV3Q2FyZERhdGEpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmRJdGVtKG5ld0NhcmRFbGVtZW50KTtcbiAgICAgIGFkZENhcmRNb2RhbC5jbG9zZSgpO1xuICAgICAgYWRkQ2FyZEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgICBhZGRDYXJkTW9kYWwucmVzZXQoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIC8vIHVzZXJJbmZvLnNldFVzZXJJbmZvKGlucHV0VmFsdWVzKTtcbiAgLyphcGlcbiAgICAuZ2V0VXNlckluZm8oKVxuICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgICB0aXRsZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHVzZXJEYXRhLmFib3V0LFxuICAgICAgfSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pOyovXG4gIHByb2ZpbGVFZGl0UG9wdXAuY2xvc2UoKTtcbiAgcHJvZmlsZUVkaXRQb3B1cC5yZXNldCgpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVJbWFnZUNsaWNrKG5hbWUsIGxpbmspIHtcbiAgaW1hZ2VNb2RhbC5vcGVuKG5hbWUsIGxpbmspO1xufVxuXG4vLyAvLyAhIHx8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18fFxuLy8gLy8gISB8fCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV2ZW50IExpc3RlbmVycyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHxcbi8vIC8vICEgfHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXx8XG5cbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYWRkQ2FyZE1vZGFsLm9wZW4oKTtcbn0pO1xuXG5jb25zdCBwcm9maWxlRWRpdFBvcHVwID0gbmV3IE1vZGFsV2l0aEZvcm0oXG4gIFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLFxuICBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdFxuKTtcblxuaW1hZ2VNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xucHJvZmlsZUVkaXRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuYWRkQ2FyZE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5kZWxldGVDYXJkTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY29uc3QgY3VycmVudFVzZXJJbmZvID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VySW5mby5uYW1lO1xuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VySW5mby5kZXNjcmlwdGlvbjtcbiAgcHJvZmlsZUZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG4gIHByb2ZpbGVFZGl0UG9wdXAub3BlbigpO1xufSk7XG5cbi8vIGZldGNoKFwiaHR0cHM6Ly9hcGkua2FueWUucmVzdFwiKVxuLy8gICAudGhlbigocmVzKSA9PiByZXMuanNvbigpKVxuLy8gICAudGhlbigoZGF0YSkgPT4ge1xuLy8gICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuLy8gICB9KTtcblxuLy8gZmV0Y2goXCJodHRwczovL2FwaS5rYW55ZS5yZXN0XCIpXG4vLyAgIC50aGVuKChyZXMpID0+IHJlcy50ZXh0KCkpXG4vLyAgIC50aGVuKChkYXRhKSA9PiB7XG4vLyAgICAgY29uc29sZS5sb2coZGF0YSk7XG4vLyAgIH0pO1xuIiwiLypDYXJkcyBzaG91bGQgYmUgcmVuZGVyZWQgYWZ0ZXIgdGhlIHVzZXIgaW5mb3JtYXRpb24gaXMgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyLiBcbtChcmVhdGUgYSBmdW5jdGlvbiBpbiBBcGkuanMgYW5kIHJldHVybiB0aGUgUHJvbWlzZS5hbGwoKSBtZXRob2QuIFxuUGFzcyB0aGUgYXJyYXkgb2YgZnVuY3Rpb24gY2FsbHMgZm9yIGdldHRpbmcgdXNlciBpbmZvcm1hdGlvbiBhbmQgdGhlIGxpc3Qgb2YgY2FyZHMgXG50byBQcm9taXNlLmFsbCgpIGFzIGEgcGFyYW1ldGVyLiovXG5cbi8vR0VUIGh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxL3VzZXJzL21lXG4vL0dFVCBodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MS9jYXJkc1xuLy9QQVRDSCBodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MS91c2Vycy9tZVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2F1dGhUb2tlbiA9IFwiMjBlNDhiMGMtODk0Ni00OGYzLTk5ZDktMDFiNTg4MTkzMTAyXCI7XG4gICAgLy8gdGhpcy5fYXV0aG9yaXphdGlvbiA9IGF1dGhvcml6YXRpb247XG4gICAgLy8gY29uc3RydWN0b3IgYm9keVxuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aFRva2VuLFxuICAgICAgfSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgLy8gcmVtZW1iZXIgdGhlIHBvaW50IG9mIHRoaXMgaXMgc28geW91IGhhdmUgc29tZXRoaW5nIHRvIHBhc3NcbiAgICAgIC8vIHdoZW4geW91IHByb2Nlc3MgdGhlIGVycm9yIGluIGNhdGNoXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gICAgLy8gICAuY2F0Y2goKGVycikgPT4ge1xuICAgIC8vICAgICBjb25zb2xlLmVycm9yKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGU7XG4gICAgLy8gICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aFRva2VuLFxuICAgICAgfSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gICAgLy8gICAuY2F0Y2goKGVycikgPT4ge1xuICAgIC8vICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH1cblxuICAvKkNhcmRzIHNob3VsZCBiZSByZW5kZXJlZCBhZnRlciB0aGUgdXNlciBpbmZvcm1hdGlvbiBpcyByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuIFxuICAgINChcmVhdGUgYSBmdW5jdGlvbiBpbiBBcGkuanMgYW5kIHJldHVybiB0aGUgUHJvbWlzZS5hbGwoKSBtZXRob2QuIFxuICAgIFBhc3MgdGhlIGFycmF5IG9mIGZ1bmN0aW9uIGNhbGxzIGZvciBnZXR0aW5nIHVzZXIgaW5mb3JtYXRpb24gYW5kIHRoZSBsaXN0IG9mIGNhcmRzIFxuICAgIHRvIFByb21pc2UuYWxsKCkgYXMgYSBwYXJhbWV0ZXIuKi9cbiAgcmVuZGVyQ2FyZHMoKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKCk7XG4gIH1cblxuICAvL1BPU1QgaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjEvY2FyZHNcblxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aFRva2VuLFxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgLy9ERUxFVEUgaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjEvY2FyZHMvY2FyZElkXG5cbiAgcmVtb3ZlQ2FyZChjYXJkSUQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSUR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl9hdXRoVG9rZW4sXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICAvL0RFTEVURSBodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MS9jYXJkcy81ZDFmMDYxMWQzMjFlYjRiZGNkNzA3ZGRcbiAgLy9QVVQgaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjEvY2FyZHMvY2FyZElkL2xpa2VzXG5cbiAgYWRkTGlrZShjYXJkSUQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSUR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl9hdXRoVG9rZW4sXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgLy9ERUxFVEUgaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjEvY2FyZHMvY2FyZElkL2xpa2VzXG5cbiAgcmVtb3ZlTGlrZShjYXJkSUQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSUR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl9hdXRoVG9rZW4sXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICAvL1BBVENIIGh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxL3VzZXJzL21lL2F2YXRhclxuXG4gIGNoYW5nZVByb2ZpbGVQaWN0dXJlKGF2YXRhckxpbmspIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGhUb2tlbixcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXI6IGF2YXRhckxpbmssIC8vIFRoZSByZXF1ZXN0IGJvZHkgY29udGFpbmluZyB0aGUgYXZhdGFyIHByb3BlcnR5XG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsIi8vIGV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEZvcm1TdWJtaXQgZXh0ZW5kcyBNb2RhbCB7XG4vLyAgIHNldFN1Ym1pdEFjdGlvbihhY3Rpb24pIHtcbi8vICAgICAvL2FjdGlvbiBpcyB0aGUgY2FsbGJhY2tcbi8vICAgfVxuXG4vLyAgIHNldEV2ZW50TGlzdGVuZXJzKCkge31cbi8vIH1cblxuaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEZvcm1TdWJtaXQgZXh0ZW5kcyBNb2RhbCB7XG4gIHNldFN1Ym1pdEFjdGlvbihzdWJtaXRDYWxsYmFjaykge1xuICAgIHRoaXMuX3N1Ym1pdENhbGxiYWNrID0gc3VibWl0Q2FsbGJhY2s7XG4gICAgLy8gYXBpLnJlbW92ZUNhcmQoaWQpLnRoZW4oKCkgPT4ge1xuICAgIC8vICAgICB0aGlzLmhhbmRsZURlbGV0ZUNhcmQoKTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgY29uZmlybURlbGV0ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX3N1Ym1pdENhbGxiYWNrO1xuICAgIH0pO1xuICB9XG5cbiAgLy90aGlzIGRvZXMgdGhlIGNsb3NlXG5cbiAgb3BlbigpIHtcbiAgICB0aGlzLnNldFN1Ym1pdEFjdGlvbigpO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoaXRlbXMpIHtcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmQoZWxlbWVudCk7XG4gIH1cblxuICBwcmVwZW5kSXRlbShlbGVtZW50KSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XG4gIH1cbn1cbiIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhJbWFnZSBleHRlbmRzIE1vZGFsIHtcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3Rvcikge1xuICAgIHN1cGVyKG1vZGFsU2VsZWN0b3IpO1xuICAgIHRoaXMuX25hbWUgPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtbGFiZWxcIik7XG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fcHJldmlldy1pbWFnZVwiKTtcbiAgfVxuXG4gIG9wZW4obmFtZSwgbGluaykge1xuICAgIHRoaXMuX2ltYWdlLnNyYyA9IGxpbms7XG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gYFBob3RvIG9mICR7dGhpcy5fbmFtZX1gO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IHByb2ZpbGVOYW1lLCBwcm9maWxlRGVzY3JpcHRpb24gfSkge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gcHJvZmlsZU5hbWU7XG4gICAgdGhpcy5fcHJvZmlsZURlc2NyaXB0aW9uID0gcHJvZmlsZURlc2NyaXB0aW9uO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgZGVzY3JpcHRpb246IHRoaXMuX3Byb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCxcbiAgICB9O1xuICB9XG5cbiAgc2V0VXNlckluZm8oeyB0aXRsZSwgZGVzY3JpcHRpb24gfSkge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdGl0bGU7XG4gICAgdGhpcy5fcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGVzY3JpcHRpb247XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlSW1hZ2VDbGljayIsImhhbmRsZURlbGV0ZUNsaWNrIiwiaGFuZGxlQWRkTGlrZSIsImhhbmRsZVJlbW92ZUxpa2UiLCJ0aGlzIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2lkIiwiX2lzTGlrZWQiLCJpc0xpa2VkIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2hhbmRsZURlbGV0ZUNsaWNrIiwiX2hhbmRsZUFkZExpa2UiLCJfaGFuZGxlUmVtb3ZlTGlrZSIsImdldElEIiwic2V0TGlrZWQiLCJfbGlrZUJ1dHRvbiIsImNsYXNzTGlzdCIsInRvZ2dsZSIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJfZGVsZXRlQnV0dG9uIiwiX2NhcmRJbWFnZSIsInNyYyIsImFsdCIsIl9jYXJkVGl0bGUiLCJ0ZXh0Q29udGVudCIsImhhbmRsZURlbGV0ZUNhcmQiLCJfY2FyZEVsZW1lbnQiLCJyZW1vdmUiLCJoYW5kbGVMaWtlSWNvbiIsImdldFZpZXciLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJfc2V0dGluZ3MiLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRFbGVtZW50cyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvbiIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwiaWQiLCJhZGQiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImhhc0ludmFsaWRJbnB1dCIsInNvbWUiLCJkaXNhYmxlZCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJmb3JFYWNoIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJyZXNldFZhbGlkYXRpb24iLCJNb2RhbCIsIm1vZGFsU2VsZWN0b3IiLCJfbW9kYWxFbGVtZW50IiwiX2Nsb3NlQnV0dG9uIiwiX2hhbmRsZU1vZGFsQ2xvc2UiLCJiaW5kIiwib3BlbiIsIl9oYW5kbGVFc2NhcGUiLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJ0YXJnZXQiLCJjb250YWlucyIsImdldEVsZW1lbnQiLCJzZXRFdmVudExpc3RlbmVycyIsIk1vZGFsV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9tb2RhbEZvcm0iLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dHMiLCJpbnB1dE9iaiIsImlucHV0IiwidmFsdWUiLCJpbnB1dFZhbHVlcyIsInJlc2V0IiwidmFsaWRhdGlvblNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsImFkZENhcmRGb3JtRWxlbWVudCIsInByb2ZpbGVFZGl0TW9kYWwiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwiYWRkTmV3Q2FyZEJ1dHRvbiIsInByb2ZpbGVGb3JtRWxlbWVudCIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImFwaSIsIl9yZWYiLCJiYXNlVXJsIiwiX2Jhc2VVcmwiLCJfYXV0aFRva2VuIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJyZW5kZXJDYXJkcyIsImFsbCIsImFkZENhcmQiLCJfcmVmMiIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3ZlQ2FyZCIsImNhcmRJRCIsImFkZExpa2UiLCJyZW1vdmVMaWtlIiwiY2hhbmdlUHJvZmlsZVBpY3R1cmUiLCJhdmF0YXJMaW5rIiwiYXZhdGFyIiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJhZGRDYXJkRm9ybVZhbGlkYXRvciIsImFkZENhcmRNb2RhbCIsInRpdGxlIiwidXJsIiwibmV3Q2FyZERhdGEiLCJuZXdDYXJkRWxlbWVudCIsImNyZWF0ZUNhcmQiLCJjYXJkc0xpc3QiLCJwcmVwZW5kSXRlbSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZGVsZXRlQ2FyZE1vZGFsIiwic2V0U3VibWl0QWN0aW9uIiwic3VibWl0Q2FsbGJhY2siLCJfc3VibWl0Q2FsbGJhY2siLCJjb25maXJtRGVsZXRlRWxlbWVudCIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiZWxlbWVudCIsImFwcGVuZCIsInByZXBlbmQiLCJjYXJkIiwiY2FyZEVsZW1lbnQiLCJjYXJkcyIsImltYWdlTW9kYWwiLCJfaW1hZ2UiLCJ1c2VySW5mbyIsIl9wcm9maWxlTmFtZSIsIl9wcm9maWxlRGVzY3JpcHRpb24iLCJkZXNjcmlwdGlvbiIsInNldFVzZXJJbmZvIiwidXNlckRhdGEiLCJhYm91dCIsIm1vZGFsRWxlbWVudCIsImxvZyIsInVwZGF0ZWRDYXJkRGF0YSIsInByb2ZpbGVFZGl0UG9wdXAiLCJjdXJyZW50VXNlckluZm8iXSwic291cmNlUm9vdCI6IiJ9